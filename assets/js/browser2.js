function makeid(){for(var e="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=0;t<10;t++)e+=a.charAt(Math.floor(Math.random()*a.length));return e}function saveBookmark(e){bookmarksData.bookmarks.push(e),storage.get("bookmarks",function(a,t){t[0].name?(t.push(e),storage.set("bookmarks",t,function(e){if(e)throw e})):storage.set("bookmarks",[e],function(e){if(e)throw e})})}function initBookmarks(){storage.get("bookmarks",function(e,a){a[0].name&&(bookmarksData.bookmarks=a)})}function addHistory(e){var a={url:e,time:Date.now()};storage.get("store",function(e,t){if(e)throw e;if(t.history){var s=t;s.history.push(a),storage.set("store",s,function(e){if(e)throw e})}else storage.set("store",{history:[a]},function(e){if(e)throw e})})}function playerPlay(){""==$("#musicPlayer").attr("src")?initMusic():($("#musicPlayer")[0].play(),$("#mPauseBtn").removeClass("fa-play"),$("#mPauseBtn").addClass("fa-pause"))}function playerPause(){$("#musicPlayer")[0].pause(),$("#mPauseBtn").removeClass("fa-pause"),$("#mPauseBtn").addClass("fa-play")}function playerStop(){playerPause(),musicData.path="",musicData.name="Stopped",musicData.time=0,musicData.timeCss="0%",musicData.timeStr="0:00",musicData.len=0,musicData.index=0}function playNextSong(e){var a=musicData.songs;e?musicData.index>0?musicData.index--:musicData.index=a.length-1:musicData.index<a.length-1?musicData.index++:musicData.index=0;var t=a[musicData.index];musicData.path=t,musicData.name=t.replace(/^.*[\\\/]/,"").replace(/\.[^\/.]+$/,""),musicData.time=0,musicData.timeCss="0%",musicData.timeStr="0:00";var s=$("#musicPlayer").get();musicData.len=s[0].duration,setTimeout(function(){playerPlay()},1e3)}function calculatePlayerBar(){var e=musicData.time,a=musicData.len,t=100*e/a;musicData.timeCss=t+"%"}function setPlayerTime(e){musicData.time=e;var a=Math.floor(e/60),t=Math.floor(e-60*a);t<10&&(t="0"+t),musicData.timeStr=a+":"+t,calculatePlayerBar()}function initMusic(e){var a=path.join(__dirname,"../../main.js");console.log(a);var t=remote.require("./main").initMusicFiles(e);musicData.songs=t,playNextSong()}function setVolume(e){var a=$("#musicPlayer").get();a[0].volume=e/200,a.volume=e/100,musicData.volume=e/100,musicData.volumeStr=e+"%",musicData.volumeCss=e+"%"}function musicSelectDir(){var e=remote.require("electron").dialog,a=e.showOpenDialog({properties:["openDirectory"]});a&&(a[0]+="\\",storage.set("music",{folder:a},function(e){if(e)throw e;console.log(a),initMusic(a[0])}))}function enableIncognito(){incognitoMode=!0,remote.require("./main").enableIncognito(),$("<link/>",{rel:"stylesheet",type:"text/css",href:"../css/torMaster.css"}).appendTo("head")}function disableIncognito(){incognitoMode=!1,remote.require("./main").disableIncognito(),$("webview").attr("webpreferences",""),$('link[rel=stylesheet][href="../css/torMaster.css"]').remove()}function newTab(e){var a=makeid();bTabs.tabs.push({url:e,id:a,name:"",tmpUrl:e}),curTab=a,displayTab(a),$("#searchBar").val("")}function extractHostname(e){var a;return a=e.indexOf("://")>-1?e.split("/")[2]:e.split("/")[0],a=a.split(":")[0]}function checkTabSize(){var e=$(".container").width(),a=bTabs.tabs.length;if(195*a>e-350){var t=(e-350)/a-2;$(".v-tab").css("width",t),$(".v-tab").css("margin-left",1),$(".v-tab").css("margin-right",1),$(".v-tab > p").css("width",t-40),$(".v-tab > .hide-text").hide()}else $(".v-tab").css("width",185),$(".v-tab > p").css("width",115),$(".v-tab").css("margin-left",5),$(".v-tab").css("margin-right",5),$(".v-tab > .hide-text").show()}function displayTab(e){curTab=e,$('.tab[web-id="'+e+'"]').css("visibility","visible"),$('.tab[web-id="'+e+'"] > webview').focus(),$('.tab:not([web-id="'+e+'"])').css("visibility","hidden"),$(".v-tab").removeClass("tab-selected"),console.log($(".v-tab[tab-id='"+e+"']")),$(".v-tab[tab-id='"+e+"']").addClass("tab-selected"),console.log(".v-tab[tab-id='"+e+"']"),$("#searchBar").val(getUrlById(e))}function getUrlById(e){return $.map(bTabs.tabs,function(a,t){if(a.id==e)return a.tmpUrl})[0]}function openPanel(){$(".tab").width($(document).width()-$("#sidePanel").width()-15),$("#sidePanel").removeClass("close"),$("#sidePanel").addClass("open")}function closePanel(){$(".tab").width("100%"),$("#sidePanel").removeClass("open"),$("#sidePanel").addClass("close")}function deleteTab(e){var a=$.map(bTabs.tabs,function(a,t){if(a.id==e)return t})[0];bTabs.tabs.splice(a,1),checkTabSize(),console.log(e),console.log(curTab),displayTab(e==curTab?bTabs.tabs[bTabs.tabs.length-1].id:curTab)}var bTabs={tabs:[]};const webSuggestionsData={search:"",suggestions:[]},bookmarksData={bookmarks:[]},musicData={name:"Stopped",path:"",len:220,time:83,timeStr:"0:00",timeCss:"0%",volumeCss:"10%",sep:"|",volume:.1,volumeStr:"10%",songs:[],index:0};var visualTabs=new Vue({el:".v-tabs",data:bTabs}),browser=new Vue({el:".webBrowser",data:bTabs}),webSuggestions=new Vue({el:".suggestions-tab",data:webSuggestionsData}),bookmarks=new Vue({el:".favBar",data:bookmarksData}),musicPlayer=new Vue({el:".musicBar",data:musicData});const auto=require("google-autocomplete"),remote=require("electron").remote,storage=require("electron-json-storage"),path=require("path");var disableNext=!1,incognitoMode=!1,playerOffset=$(".progress-bar").position().left,playerClick=!1,volumeOffset=$(".songVol").offset().left,volumeClick=!1,curTab="";newTab("https://www.google.com");var player=$("#musicPlayer").get();player[0].volume=.1,$(".favBar").on("click",".bookmark",function(){var e=$(this).attr("mark-url"),a=$.map(bTabs.tabs,function(e,a){if(e.id==curTab)return a})[0];bTabs.tabs[a].url=e}),$(".search-right").on("click","#bookmarkBtn",function(e){$("#bookmarkName").val($("#"+curTab)[0].getTitle()),$(".bookmarkInf").show()}),$("#bookmarkSaveBtn").click(function(e){$(".bookmarkInf").hide();var a=$("#bookmarkName").val();console.log("book"),console.log(a),saveBookmark({name:a,url:getUrlById(curTab)})}),$("#bookmarkDeleteBtn").click(function(e){$(".bookmarkInf").hide()}),initBookmarks(),storage.set("store",{history:[]},function(e){if(e)throw e}),storage.get("music",function(e,a){$(".folder-path").text(a.folder[0])}),$(window).resize(function(){checkTabSize(),playerOffset=$(".progress-bar").position().left,volumeOffset=$(".songVol").offset().left}),$(".progress-bar").mouseleave(function(){playerClick=!1}),$(document).mouseup(function(){playerClick=!1}),$(".progress-bar").mousedown(function(){playerClick=!0,console.log(event.pageX);var e=event.pageX-playerOffset,a=musicData.len,t=e*a/200;if(console.log(t),t<=a)var s=$("#musicPlayer").get();console.log("cha"),s[0].currentTime=t,setPlayerTime(t)}),$(".progress-bar").mousemove(function(e){if(playerClick){var a=e.pageX-playerOffset,t=musicData.len,s=a*t/200;if(console.log(s),s<=t)var o=$("#musicPlayer").get();console.log("cha"),o[0].currentTime=s,setPlayerTime(s)}}),$(".songVol").mouseleave(function(){volumeClick=!1,console.log("leave")}),$(document).mouseup(function(){volumeClick=!1}),$(".songVol").mousedown(function(){volumeClick=!0,console.log("vol");var e=event.pageX-volumeOffset,a=Math.floor(100*e/60);console.log(a),a<=100&&a>=0&&setVolume(a)}),$(".songVol").mousemove(function(e){if(volumeClick){var a=e.pageX-volumeOffset,t=Math.floor(100*a/60);console.log(t),t<=100&&t>=0&&setVolume(t)}}),$("#musicPlayer").on("durationchange",function(){musicData.len=this.duration}),$("#musicPlayer").on("timeupdate",function(){setPlayerTime(this.currentTime)}),$("#musicPlayer").on("ended",function(){playNextSong()}),$("#mPauseBtn").click(function(){$("#musicPlayer").get()[0].paused?playerPlay():playerPause()}),$("#mForwardBtn").click(function(){playNextSong()}),$("#mBackBtn").click(function(){playNextSong(!0)}),$("#mStopBtn").click(function(){playerStop()}),$("#musicSelect").click(function(){musicSelectDir()}),$("#incognitoBtn").click(function(){incognitoMode?disableIncognito():enableIncognito()}),$("#settingsBtn").click(function(){$("#sidePanel").hasClass("open")?closePanel():openPanel()}),$(document).arrive(".v-tab",function(){checkTabSize()}),$(document).arrive("webview",function(){var e=$(this)[0];e.addEventListener("did-start-loading",loadstart),e.addEventListener("did-stop-loading",loadstop),e.addEventListener("did-fail-load",loadfail),e.addEventListener("new-window",newWindow),e.addEventListener("page-favicon-updated",favicon)});const favicon=function(e){e.favicons.length>0&&$(".v-tab[tab-id='"+e.srcElement.id+"'] > .fav > img").attr("src",e.favicons[0]),console.log(e.favicons)},loadstart=function(e){$("#refreshBtn").removeClass("fa-refresh"),$("#refreshBtn").addClass("fa-times"),$(".is-secure").hide(),$("#searchBar").removeClass("sec"),$(".v-tab[tab-id='"+e.srcElement.id+"'] > .fav > img").hide(),$('.v-tab[tab-id="'+e.srcElement.id+'"] > .lc').show();var a=$.map(bTabs.tabs,function(a,t){if(a.id==e.srcElement.id)return t})[0];bTabs.tabs[a].name=e.srcElement.src,$(".suggestions-tab").removeClass("act"),webSuggestionsData.suggestions=[],console.log("Loading...")},loadfail=function(e){switch(console.log(e),console.log("fail"),e.errorCode){case-501:console.log("Push");var a=remote.getGlobal("ignoredDomains").urls;a.push(extractHostname(e.srcElement.src)),remote.getGlobal("ignoredDomains").urls=a,console.log(remote.getGlobal("ignoredDomains").urls);break;case-120:case-105:disableNext=!0,e.srcElement.loadURL("file://"+__dirname+"/assets/error/105.html")}},newWindow=function(e){console.log("New page: "+e.url),newTab(e.url)},loadstop=function(e){console.log(e),$("#refreshBtn").removeClass("fa-times"),$("#refreshBtn").addClass("fa-refresh"),$('.v-tab[tab-id="'+e.srcElement.id+'"] > .lc').hide(),$(".v-tab[tab-id='"+e.srcElement.id+"'] > .fav > img").show();var a=e.srcElement;console.log(a.id);var t=$.map(bTabs.tabs,function(e,t){if(e.id==a.id)return t})[0];console.log("Stopped Loading");var s=a.getURL();incognitoMode||addHistory(s);var o=a.getTitle();bTabs.tabs[t].name=o,document.title=o,disableNext?disableNext=!1:(bTabs.tabs[t].tmpUrl=s,console.log(s),$("#searchBar").val(s),0==s.indexOf("https://")&&($(".is-secure").show(),$("#searchBar").addClass("sec")))};$("#searchBar").keypress(function(e){if(13==e.which){var a=$("#searchBar").val(),t=a;a.indexOf(".")<0&&a.indexOf(":")<0||a.indexOf(".")==a.lenght||0==a.indexOf(".")?t=incognitoMode?"https://www.duckduckgo.com/?q="+a:"https://www.google.com/#q="+a:a.startsWith("http://")||a.startsWith("https://")||(t="https://"+a);var s=$.map(bTabs.tabs,function(e,a){if(e.id==curTab)return a})[0];bTabs.tabs[s].url=t}}),$("#backBtn").click(function(e){$("#"+curTab)[0].goBack()}),$("#forwardBtn").click(function(e){$("#"+curTab)[0].goForward()}),$("#refreshBtn").click(function(e){$("#"+curTab)[0].reload()}),$("#homeBtn").click(function(e){var a=$("#"+curTab)[0];incognitoMode?a.loadURL("https://www.duckduckgo.com"):a.loadURL("https://www.google.com")}),$(".add-tab").click(function(e){newTab(incognitoMode?"https://www.duckduckgo.com":"https://www.google.com")}),global.disableJS=function(){$("webview").attr("webpreferences","javascript=no");var e=$(".webBrowser").detach();console.log(e),$(".webBrowser").remove(),$(".container").append(e)},global.enableJS=function(){$("webview").attr("webpreferences","");var e=$(".webBrowser").detach();console.log(e),$(".webBrowser").remove(),$(".container").append(e)},$(".v-tabs").on("mousedown",".v-tab",function(e){if(e.target!=$(this).find("div.tab-close")[0]){var a=$(this).attr("tab-id");curTab=a,console.log(a),displayTab(a)}}),$(".v-tabs").on("click",".tab-close",function(){var e=$(this).parent().attr("tab-id");if(bTabs.tabs.length<=1){remote.getCurrentWindow().close()}setTimeout(function(){deleteTab(e)},100)}),$(".v-tabs").on("mouseenter",".v-tab",function(){$(this).find(".tab-close").animate({opacity:.99},0)}),$(".v-tabs").on("mouseleave",".v-tab",function(){$(this).find(".tab-close").animate({opacity:.01},0)}),$(".v-tabs").sortable({axis:"x",containment:"parent",tolerance:"pointer"}),$(".v-tabs").disableSelection(),$(".left-items").sortable({axis:"x",containment:"parent"}),$(".left-items").disableSelection(),$(".favBar").sortable({axis:"x",containment:"parent",tolerance:"pointer"}),$(".favBar").disableSelection(),$(".min-icon").click(function(e){remote.getCurrentWindow().minimize()}),$(".max-icon").click(function(e){var a=remote.getCurrentWindow();a.isMaximized()?a.unmaximize():a.maximize()}),$(".close-icon").click(function(e){remote.getCurrentWindow().close()}),$(".suggestions-tab").on("click",".suggestion",function(){var e=$(this).find("p").text();$("#searchBar").val(e);var a=$.map(bTabs.tabs,function(e,a){if(e.id==curTab)return a})[0];bTabs.tabs[a].url="https://www.google.com/#q="+e,$(".suggestions-tab").removeClass("act"),webSuggestionsData.suggestions=[]}),$("#searchBar").on("paste keyup",function(e){if(13!=e.which&&38!=e.which&&40!=e.which&&!incognitoMode){$(".suggestions-tab > .suggestion.sel").length||$(".suggestions-tab > .suggestion:nth-child(1)").addClass("sel");var a=$("#searchBar").val();webSuggestionsData.search=a,auto.getQuerySuggestions(a,function(e,t){if(""==a&&$(".suggestions-tab").removeClass("act"),a.indexOf("://")<0){for(var s=[],o=0;o<t.length;o++)(t[o].relevance>=600||o<4)&&o<5&&s.push(t[o].suggestion);webSuggestionsData.suggestions=s}webSuggestionsData.suggestions.length>0&&$(".suggestions-tab").addClass("act")})}}),$("#searchBar").keydown(function(e){if($(".is-secure").hide(),$("#searchBar").removeClass("sec"),$(".suggestions-tab").hasClass("act")){var a=$(".sel").index()+1;40==e.which&&a<$(".suggestions-tab").children().length?(a++,$(".suggestions-tab > .suggestion.sel").removeClass("sel"),$(".suggestions-tab > .suggestion:nth-child("+a+")").addClass("sel"),$("#searchBar").val($(".suggestions-tab > .suggestion.sel > p").text())):38==e.which&&1!=a&&(e.preventDefault(),a--,$(".suggestions-tab > .suggestion.sel").removeClass("sel"),$(".suggestions-tab > .suggestion:nth-child("+a+")").addClass("sel"),$("#searchBar").val($(".suggestions-tab > .suggestion.sel > p").text())),38==e.which&&e.preventDefault()}});